@using AnThinhPhat.ViewModel.TacNghiep;

@model DetailTacNghiepViewModel

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<link href="~/Content/app/plus.css" rel="stylesheet" />
<style>
    .hiddenRow {
        padding: 0px !important;
    }

    .glyphicon:hover {
        cursor: pointer;
    }
</style>

<div class="row">
    <div class="col-sm-6">
        <label>Ngày tạo</label>
        @Html.DisplayFor(x => x.NgayTao, "DateTime")
    </div>

    <div class="col-sm-6">
        <label>Ngày hết hạn</label>
        @Html.DisplayFor(x => x.NgayHetHan, "DateTime")
        @Html.ValidationMessageFor(x => x.NgayHetHan)
    </div>

    <div class="col-sm-6">
        <label>Ngày hoàn thành</label>
        @Html.DisplayFor(x => x.NgayHoanThanh, "DateTime")
    </div>

    <div class="col-sm-6">
        <label>Lĩnh vực</label>
        @Html.TextBoxFor(x => x.LinhVucString, htmlAttributes: new { @class = "form-control", @readonly = "readonly" })
    </div>

    <div class="col-md-12">
        <label>Nội dung</label>
        @Html.TextAreaFor(x => Model.NoiDung, htmlAttributes: new { @class = "form-control", rows = 10, @readonly = "readonly" })
    </div>

    <div class="col-sm-12 table-responsive" style="padding:30px 15px 15px 15px;">
        <label>Các cơ quan có liên quan</label>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="col-sm-10">Tên cơ quan</th>
                    <th class="col-sm-2">Có liên quan</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.CoQuanInfos)
            {
                    <tr>
                        <td>@item.CoQuanInfo.IfNotNull(x => x.Name)</td>
                        <td>
                            <input type="checkbox" value="true" checked="checked" />
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="col-md-12" style="padding-bottom:30px;">
        <label>Nội dung ý kiên trao đổi</label>
        @Html.TextAreaFor(x => Model.NoiDungYKienTraoDoi, htmlAttributes: new { @class = "form-control", rows = 10, @readonly = "readonly" })
    </div>

    <div class="col-sm-12">
        <label>Các tập tin đính kèm</label>
        <div style="padding-bottom:30px;">
            @Html.Raw(Model.JsonFiles)
        </div>
    </div>

    <div class="col-sm-12" id="formYKienCoQuan">
        <label>Nội dung ý kiến của các cơ quan</label>
        @{ Html.RenderAction("NoiDungYKienCuaCacCoQuan", new { id = Model.Id });}
    </div>

    <div class="col-sm-12">
        <label>Tình hình thực hiện công việc của các cơ quan</label>
        @{ Html.RenderAction("TinhHinhThucHien", new { id = Model.Id });}
    </div>
</div>

<div class="modal fade in" id="modalEditYKienCoQuan">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Chỉnh sửa nội dung</h4>
            </div>
            <div class="modal-body" id="modalEditBody">
                @*Will insert data to here*@
            </div>
        </div>
    </div>
</div>

@section Scripts{

    <script src="~/Scripts/app/modaljs.js"></script>

    <script>
        $(document).ready(function () {

            $('#modalEditBody').height(260);

            $('#formYKienCoQuan').on('click', '.btn-edit', function (event) {
                event.preventDefault();
                var url = $(this).attr('href');

                $('#modalEditBody').load(url);
                $('#modalEditYKienCoQuan').modal({ backdrop: 'static', keyboard: false, show: true });
            });

            onEditYKienBegin = function () {
                onShowLoading();
            };
            onEditYKienComplete = function () {
                onHideLoading();
            };
            onEditYKienSuccess = function () {
                //reload page
                var url = window.location.href;
                window.location.href = url;
            };
            onEditYKienFailure = function () {
                alert("Đã xảy ra lỗi trong quá trình cập nhật. Xin vui lòng thử lại");
            };

            onAddYKienBegin = function () {
                onShowLoading();
            };
            onAddYKienComplete = function () {
                onHideLoading();
            };
            onAddYKienSuccess = function () {
                //reload page
                var url = window.location.href;
                window.location.href = url;
            };
            onAddYKienFailure = function () {
                alert("Đã xảy ra lỗi trong quá trình cập nhật. Xin vui lòng thử lại");
            };


            $('#formYKienCoQuan').on('change', 'input[type="file"]', function (e) {
                $('#spanUpload').text('');
                var files = e.originalEvent.target.files;
                if (files.length > 0) {
                    $(this).next().removeAttr('disabled');
                }
                else {
                    $(this).next().attr('disabled', 'disabled');
                }
            });
        });
    </script>
}